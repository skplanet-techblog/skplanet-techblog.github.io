{"componentChunkName":"component---src-templates-blog-post-js","path":"/opa/","result":{"data":{"site":{"siteMetadata":{"title":"SK플래닛 TECH TOPIC"}},"markdownRemark":{"id":"f773079b-52cc-5d03-b130-9eeae28dcedc","excerpt":"본 글은 SK플래닛에서 OPA(Open Policy Agent)를 이용하여 사내 JIRA의 권한을 구현한 사례를 공유하며, 아래와 같이 크게 세 가지 작업을 정리하고자 합니다. 첫번째는 개발 중인 ITSM 시스템에서 권한 부분을 OPA를 이용해 구현합니다. 정책은 Rego로 작성합니다. 두번째는 작성된 정책을, data API…","html":"<p>본 글은 SK플래닛에서 OPA(Open Policy Agent)를 이용하여 사내 JIRA의 권한을 구현한 사례를 공유하며, 아래와 같이 크게 세 가지 작업을 정리하고자 합니다.</p>\n<ul>\n<li>첫번째는 개발 중인 ITSM 시스템에서 권한 부분을 OPA를 이용해 구현합니다.\n<ul>\n<li>정책은 Rego로 작성합니다.</li>\n</ul>\n</li>\n<li>두번째는 작성된 정책을, data API를 이용해 권한 체크를 구현합니다.</li>\n<li>세번째는 애플리케이션과 OPA 서버를 하나의 파드로 묶어 사이드카 형태로 쿠버네티스 개발 환경에 배포합니다.</li>\n</ul>\n<h2>본문</h2>\n<ul>\n<li>ITSM 시스템의 백엔드를 Java Spring 및 JPA를 사용하여 개발하였고, 현재 사용 중인 JIRA를 대체할 예정입니다.</li>\n<li>JIRA의 데이터를 이전할 계획이라, JIRA의 데이터 구조를 그대로 사용하고자 합니다.</li>\n<li>JIRA의 권한 관련 데이터 및 권한 정책을 확인하였습니다.</li>\n<li>JIRA의 프로젝트 관리 권한을 가진 사용자라면 아래와 같은 페이지에서 프로젝트의 롤과 퍼미션의 수정이 가능합니다.</li>\n<li>Users and Roles 에서 ADMINISTRATORS/DEVELOPERS/USERS 롤에 그룹 및 사용자를 할당할 수 있습니다.</li>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bcd8e4cdce88da38188ebbeb568f604/8c557/opa-image01_.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVR42o1T25KDIBTj/79zvXR0BUHlKllCi+N2+tDMZCynnhA4UfR9j3EcMQwDrLUIIcB7D+fc12Rfzie6roPQZkc6M4icM6SUUEpW0W8R01k0gH4YIeZlhTS2FE6chRTcjwOHi7A+1qcLqbo4Sp2OUkp1c72WXrnAGF2FH48HxKI0lHH1BXItL62rvo5Oxhj/rdvvWW54/GosulxVcfjTDRBSmeoCL0GtdRWlm+boLtbI+r5bbEd5Wo+UKdjToal30Bwqpapou0M2UriB4tyQrrtJwzqPfKbnkctwq+DhwiW473slhc7XvZLtf7LV1o2piGXzUAWZFjHNC6ZZ1h2J5pBOiDaMTw4JDohrYpomiF9ZhrL5KzZspkM23t3cSZH39W3KBkuJTYjPYo1NEWxowb0yV5zRUROhIE9EzPMMwYg4H644tCPeI/I+5U9TJ/jV/QH2GlpYfgSEMQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"opa-image01_\"\n        title=\"\"\n        src=\"/static/6bcd8e4cdce88da38188ebbeb568f604/f058b/opa-image01_.png\"\n        srcset=\"/static/6bcd8e4cdce88da38188ebbeb568f604/c26ae/opa-image01_.png 158w,\n/static/6bcd8e4cdce88da38188ebbeb568f604/6bdcf/opa-image01_.png 315w,\n/static/6bcd8e4cdce88da38188ebbeb568f604/f058b/opa-image01_.png 630w,\n/static/6bcd8e4cdce88da38188ebbeb568f604/8c557/opa-image01_.png 700w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></li>\n<li>Project Permissions 에서 각 퍼미션에 사용자, 그룹 및 위에서 할당한 롤을 추가할 수 있습니다.</li>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea230d1b8ec0749080183fb5b2c7a267/8c557/opa-image02_.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.86075949367089%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVR42o1Sa4+DMAzj///Csc87GM9CR8sbX50taNoNdJGs0jZxHJcoLw3ah8M8TXDOIysq/KQZsryCDefO9xjH8RBTqJvnWVZGZFqHaVllw4v0fkdZVSFhxrYhYMNZsKbrOlhrpUHUWIdlJeGGZVlQlmVAgWEYhIxYw71+v4NBZSQjSB7ZzmMYF0oRwiqoIym7Dn0vZIwjQqoqigJ1XT9HLit62MlGCdM0ldV7j75/eviNcHuJ0DwhLGoLY/3uxz14yG46JtezkdVDguPLyA8/7oUc1xgjl+zKgiN16mHTNOKhKORraighEzgGk7XREdjQOScKhZAHn4Rt28orf0L9VAv0UbTmpXDaX5EG53kuI7OI+29495VN6DtJuf+jkGT6Yv8JCtJfjc2iLMvkVXnI/ymOY9xutz3pDMxJkgSXywXX61XqfwEdvaezR5I4+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"opa-image02_\"\n        title=\"\"\n        src=\"/static/ea230d1b8ec0749080183fb5b2c7a267/f058b/opa-image02_.png\"\n        srcset=\"/static/ea230d1b8ec0749080183fb5b2c7a267/c26ae/opa-image02_.png 158w,\n/static/ea230d1b8ec0749080183fb5b2c7a267/6bdcf/opa-image02_.png 315w,\n/static/ea230d1b8ec0749080183fb5b2c7a267/f058b/opa-image02_.png 630w,\n/static/ea230d1b8ec0749080183fb5b2c7a267/8c557/opa-image02_.png 700w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></li>\n<li>이렇게 화면에서 설정한 값은 JSON으로 아래와 같이 표현합니다(JIRA API를 통해 확인).\n<ul>\n<li>파일 크기가 꽤 되므로 일부 내용만 캡쳐하며, permissionKey(퍼미션 내용)과 grants(권한부여) 을 포함한 동일한 형태의 퍼미션을 배열로 정의하고 있습니다.</li>\n<li>해당 JSON을 OPA에서 권한 체크 시, 데이터로 사용합니다.</li>\n</ul>\n</li>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9c09b7b93dddfe45d937e094e03c46b4/1cfc2/opa-image03_.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.37974683544303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiUlEQVR42p2U63KkIBCF5/0fbfMA2V+ZGWdG8QYochGBk4Yxqdqt3Uqi1iko1M9Dd9OnRWmIfoKzFmHz2LbtsJxzOOWJ1Y6gGkqtABKOXpl12sIGJRawm0TNOYalh9ACMcVjwEDARRp09xEZnvb7sEPvfQHIfgZnE8ZuhlGOHobiMqX0qW8DsyEpJ7R9Bz0ZGOkQfPgW5N8O6cOJzxjuHHoxaFSNil9xHa+oSOf+DefhjG7qSC36uUdLYyNZWWOyQYgBIYTdIVnkzYTL6wOPG0M91fj1+6UAueYYSTwnKn6EAGWMeyjivpPicLUyTyFbAfaocWFvaOUDwvRQVmAmPUsplveK0l/a17eN6nDVLVJQWMRA8RvQjhU4AUOQ8F5QsUukqIrwhTY/E3Bdi9WfJuC/SclAZxzsspKjD3A6dGKehU3ZUXzB/SJw6wSkEVTg4bjDJ1CDVRRDb+GCPXTs/qjDGCLVoYKZaevaU0IikA5u2ea2RWc4tzBW9UVDw5HbWv7ZT9rXujq8A5h25s8nj5LXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"opa-image03_\"\n        title=\"\"\n        src=\"/static/9c09b7b93dddfe45d937e094e03c46b4/f058b/opa-image03_.png\"\n        srcset=\"/static/9c09b7b93dddfe45d937e094e03c46b4/c26ae/opa-image03_.png 158w,\n/static/9c09b7b93dddfe45d937e094e03c46b4/6bdcf/opa-image03_.png 315w,\n/static/9c09b7b93dddfe45d937e094e03c46b4/f058b/opa-image03_.png 630w,\n/static/9c09b7b93dddfe45d937e094e03c46b4/1cfc2/opa-image03_.png 900w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></li>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/daf849d72a15fed942fb0e5bdcb90acb/2dc7d/opa-image04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACbUlEQVR42qWU6XKjMBCE/f6Pt4kNGF9gMIcRp4QEOO6dGSfO5ld2s7imBlSlj6Z7rFWjWqhLAz1oLLcFt/mGZV4wTdM/1TzP0FpjNU0OdnDoigHWWNSuxjAN+MnF0JXQ7YwqrglsoUaFznU/Bzrn6PaOrhxQphrGjVjelv8Dvt3fMI3kwTjC3ix+ej2B8zTjttxwv98FPt/I6IWKOq9x/ROwSXuUgUKpKgS1j0IXArOL/WvYE2hGg6zKkBQpirZAXMfI2gy1rqEGhetwRW1qUj2L+m+BvenxenrBy+kXtlkA77zB5ryWNb7ndS9ZIypPKLsSbrZUTizhbicrxc/WWawGMyBIfNrs4VDuBborQgSpj2N5wFmdCRZRj0WtdlrKOANtBwxU3M1kYKx5ADcRK3rFLg/hJ57AuG/TAKfyiOh6Qk42sK/ffrIoJIBHgH25Q5htpbZUB1KYNRfkXSbq3OJkI+X+hNzff1+AXrzBOvpUuL0E0jfxWrqfekhUIj59bH72P8bqC5A3h/lWAOwhQ/bZDqlKCXaGmc23Y8N/YwEyhBPdFztRx51t2GUh4irC8Xp8jg4nK+lS2h/Fz6z4MTa6F3X8yaIw5U/kUHx5iZdsHv7me8SUNr+g7Ao0A89pBdUrtKahlDUGGsH3UB6esbJQwtiJn3zPnYtB7OOlSSWkvM2pF2jHnuyw0DQ2je6wquqcPFzTAL98js3Ff/boGknSrEqRqqqv0JAiPdJx50iZpfPTVBjdY22lVIEw2SI40yAXB4RpSGHsZS1MSeElxDE/SEBJdUZRF7i2JdqehtwoTG6gE97Q4TJiNB1+A8W4rTdFzJeuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"opa-image04\"\n        title=\"\"\n        src=\"/static/daf849d72a15fed942fb0e5bdcb90acb/f058b/opa-image04.png\"\n        srcset=\"/static/daf849d72a15fed942fb0e5bdcb90acb/c26ae/opa-image04.png 158w,\n/static/daf849d72a15fed942fb0e5bdcb90acb/6bdcf/opa-image04.png 315w,\n/static/daf849d72a15fed942fb0e5bdcb90acb/f058b/opa-image04.png 630w,\n/static/daf849d72a15fed942fb0e5bdcb90acb/40601/opa-image04.png 945w,\n/static/daf849d72a15fed942fb0e5bdcb90acb/78612/opa-image04.png 1260w,\n/static/daf849d72a15fed942fb0e5bdcb90acb/2dc7d/opa-image04.png 1760w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></li>\n<li>이러한 구조를 염두해 두고 권한 처리를 생각해 보면, 사용자 및 사용자의 그룹이 속한 <strong>롤</strong>을 확인하고,</li>\n<li>사용자 아이디, 그룹명, 롤명으로 permissions의 grants를 뒤져서 해당 사용자가 해당 퍼미션에 권한이 있는지 여부를 확인할 수 있습니다.</li>\n<li>복잡해 보이지만 의외로 간단합니다. Rego를 작성해 봅니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">package app.rbac\n\nimport future.keywords.if\n\n# By default, deny requests.\ndefault allow := false\n\nallow {\n   # Find grants for the permissionKey.\n   user_is_granted[_] == input.permissionKey\n}\n\nuser_is_granted := grant if {\n   #내가 가진 프로젝트 롤\n   myRoleWithUser := {ro.id | ro = data[input.project.key].roles[_]; ro.users[_].name = input.user}\n\n   #내가 포함된 그룹이 가진 프로젝트 롤\n   myRoleWithGroup := {ro.id | ro = data[input.project.key].roles[_]; ro.groups[_].name = input.groups[_]}\n\n   #권한 체크를 하고자 하는 프로젝트의 퍼미션조회\n   perm := {pe | pe = data[input.project.key].permissions[_]}\n\n   #나의 롤에게 부여된 퍼미션\n   grantOfUserRole := {gr | gr = perm[ur].permissionKey; to_number(perm[ur].grants[_].values[_].value) == myRoleWithUser[_]}\n\n   #나의 그룹의 롤에게 부여된 퍼미션\n   grantOfGroupRole := {gr | gr = perm[gr].permissionKey; to_number(perm[gr].grants[_].values[_].value) == myRoleWithGroup[_]}\n\n   #나에게 부여된 퍼미션\n   grantOfUser := {gr | gr = perm[u].permissionKey; perm[u].grants[_].values[_].value == input.user}\n\n   #나의 그룹에게 부여된 퍼미션\n   grantOfGroup := {gr | gr = perm[g].permissionKey; perm[g].grants[_].values[_].value == input.groups[_]}\n\n   #위의 퍼미션의 합집합\n   grant := grantOfUserRole | grantOfGroupRole | grantOfUser | grantOfGroup\n}</code></pre></div>\n<ul>\n<li>작성한 정책(rego)과 데이터을 이용하여 권한을 체크합니다. OPA 플레이그라운드에서 테스트할 수 있습니다.\n<ul>\n<li><a href=\"https://play.openpolicyagent.org/p/7dwdCy843A\">https://play.openpolicyagent.org/p/7dwdCy843A</a></li>\n</ul>\n</li>\n<li>백엔드 서버에서 OPA data API를 이용하여  권한 체크를 하는 로직을 개발해 봅니다.</li>\n<li>Spring Security의 PreAuthorize 태그를 이용합니다.</li>\n<li>Spring Controller에 권한 체크를 위해 PreAuthorize 태그를 추가합니다.</li>\n<li>PreAuhorize에서 opaclient.allow를 호출합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@PreAuthorize(\"@opaClient.allow('CREATE_ATTACHMENTS',T(java.util.Map).of('key', #key))\")\n@PostMapping(value = \"{version}/issue/{key}/attachments\")\n@ResponseBodypublic ResponseEntity uploadFile(@PathVariable String version,@PathVariable String key,\n                       @RequestParam List&lt;MultipartFile> file) throws IOException {\n    List&lt;TicketFile> ticketFiles = ticketService.uploadFiles(key, file);\n    return new ResponseEntity(ticketFiles, HttpStatus.OK);\n\n}\n@PreAuthorize(\"@opaClient.allow('TRANSITION_ISSUES',T(java.util.Map).of('key', #key))\")\n@PutMapping(value=\"/issue/{key}/{issueEvent}\")\n@ResponseBodypublic ResponseEntity updateState(@PathVariable String key,@PathVariable String issueEvent){\n    IssueEvent event = IssueEvent.valueOf(issueEvent);\n\n    Ticket ticket = ticketService.updateIssueState(key, event);\n    return new ResponseEntity(ticket, HttpStatus.OK);\n}</code></pre></div>\n<ul>\n<li>opaClient.allow는 아래와 같이 구현하였습니다.</li>\n<li>input으로 사용자 아이디와 그룹, 권한을 체크하고자 하는 프로젝트와 퍼미션를 입력합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">//URI는 OPA 서버의 endpoint로 http://localhost:8181 로 설정한다.\n@Value(\"${opa.url}\")\nString URI;\n\npublic boolean allow(String action, Map&lt;String, Object> resourceAttributes) {\n        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();\n        if (authentication == null || !authentication.isAuthenticated() || action == null \n                             || resourceAttributes == null || resourceAttributes.isEmpty()) {\n            return false;\n        }\n\n        String name = authentication.getName();\n        List&lt;String> authorities = authentication.getAuthorities()\n                .stream()\n                .map(GrantedAuthority::getAuthority)\n                .collect(Collectors.toUnmodifiableList());\n\n        Object project = null;\n\n        if (resourceAttributes.containsKey(\"key\")){\n            String issueKey = (String) resourceAttributes.get(\"key\");\n            String projectKey = issueKey.substring(0, issueKey.indexOf(\"-\"));\n            project = Map.of(\"key\", projectKey);\n        }\n\n        /**\n         * {\n         *     \"groups\": [\n         *         \"ITSM-users\"\n         *     ],\n         *     \"permissionKey\": \"ADD_COMMENTS\",\n         *     \"projectKey\":\"TEMP\",\n         *     \"user\": \"1004196\"\n         * }\n         */\n        Map&lt;String, Object> input = Map.of(\n                \"user\", name,\n                \"permissionKey\", action,\n                \"project\", project,\n                \"groups\", authorities\n        );\n\n        ObjectNode requestNode = objectMapper.createObjectNode();\n        requestNode.set(\"input\", objectMapper.valueToTree(input));\n        log.info(\"Authorization request:\\n\" + requestNode.toPrettyString());\n\n        JsonNode responseNode = Objects.requireNonNull(restTemplate.postForObject(URI+\"/v1/data/app/rbac/allow\",\n                                                                                  requestNode, JsonNode.class));\n        log.info(\"Authorization response:\\n\" + responseNode.toPrettyString());\n\n        return responseNode.has(\"result\") &amp;&amp; responseNode.get(\"result\").asBoolean();\n    }</code></pre></div>\n<ul>\n<li>개발한 백엔드 서버와 OPA 서버을 쿠버네티스(이하 k8s) 환경에 개발 서버로 배포해 봅니다.</li>\n<li>아래 k8s deployment yaml를 이용하여, 백엔드 서버(pitsm-backend)와 OPA 서버를 한 pod 내에 container로 배포합니다.</li>\n<li>OPA 서버를 사이드카 형태로 실행하면 아래와 같은 장점이 있습니다.\n<ul>\n<li>localhost:8181을 통해 권한을 체크하므로, 네트웍 지연을 없앨 수 있음</li>\n<li>애플리케이션과 함께 배포되며, 애플리케이션과 함게 스케일링되어 운영 및 관리가 용이함</li>\n<li>단점도 있음. data를 수정하는 경우, 사이드카 형태의 각 OPA 서버에게 data 수정 API를 요청해야 함</li>\n<li>메시지 브로커를 사용하여 각 애플리케이션에서 이벤트를 받아 data를 수정하도록 함</li>\n<li>또는 OPAL을 이용하여 OPA의 정책과 데이터를 동기화할 수 있음</li>\n</ul>\n</li>\n<li>OPA 서버를 시작할때 /policies 경로에 정책을 사용하도록 설정하였습니다.</li>\n<li>opa-policy configmap을 rego파일을 이용해 생성하고, /policies 경로에 마운트합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    spec:\n      volumes:\n        - name: opademo-policy\n          configMap:\n            name: opademo-policy\n            defaultMode: 420\n      containers:\n        - name: pitsm-backend\n          image: dev.pcr.kr/devops/pitsm-backend:20230328142251          \n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: kube\n          resources: {}\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            privileged: false\n        - name: opa\n          image: openpolicyagent/opa:latest\n          args:\n            - run\n            - '--ignore=.*'\n            - '--server'\n            - /policies\n          ports:\n            - name: http\n              containerPort: 8181\n              protocol: TCP\n          resources: {}\n          volumeMounts:\n            - name: opademo-policy\n              readOnly: true\n              mountPath: /policies</code></pre></div>\n<h2>마무리</h2>\n<ul>\n<li>권한 기능을 Java로 구현할까도 생각했지만, 구현의 단순함이나 성능에서 OPA로 구현한 것에 만족함(자바로 구현했다면 데이터의 저장을 위해, 퍼미션 및 롤 데이터를 위한 스키마 설계 부터 머리가 아플 듯).</li>\n<li>여러 개의 테이블로 구성하고 관계를 설정할 생각을 하면 머리가 아픔.</li>\n<li>현재는 JSON 형태의 데이터를 통으로 DB 컬럼에 저장 중임.</li>\n<li>DB에서 데이터를 조회해서 권한 체크를 할 것이 아니기 때문에, 굳이 테이블을 나눠서 인덱스를 생각할 필요가 없음.</li>\n<li>OPA는 데이터를 메모리에 올려놓고 실행되기 때문에 빠르게 동작할 것으로 기대함.</li>\n<li>또한 사이드카로 구성하여, 애플리케이션에서 권한 요청시 네트웍 지연을 없앤 것도 맘에 듬.</li>\n<li>다만 데이터 동기화를 위한 추가 작업이 필요함.\n<ul>\n<li>메시지 브로커를 이용해 애플리케이션에서 업데이트 작업을 하거나,</li>\n<li>OPAL를 도입하여 데이터 동기화를 하는 등의 작업이 필요함.</li>\n</ul>\n</li>\n</ul>\n<p>읽어 주셔서 감사합니다!</p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://devocean.sk.com/search/techBoardDetail.do?ID=163522\">https://devocean.sk.com/search/techBoardDetail.do?ID=163522</a></li>\n<li><a href=\"https://devocean.sk.com/search/techBoardDetail.do?ID=163580\">https://devocean.sk.com/search/techBoardDetail.do?ID=163580</a></li>\n<li><a href=\"https://devocean.sk.com/search/techBoardDetail.do?ID=163530\">https://devocean.sk.com/search/techBoardDetail.do?ID=163530</a></li>\n<li><a href=\"https://learning.oreilly.com/videos/how-netflix-enforces/0636920424208/0636920424208-video329910/\">https://learning.oreilly.com/videos/how-netflix-enforces/0636920424208/0636920424208-video329910/</a></li>\n<li><a href=\"https://www.openpolicyagent.org/docs/latest/rest-api/#get-a-document-with-input\">https://www.openpolicyagent.org/docs/latest/rest-api/#get-a-document-with-input</a></li>\n<li><a href=\"https://docs.opal.ac/getting-started/intro\">https://docs.opal.ac/getting-started/intro</a></li>\n<li><a href=\"http://www.yes24.com/Product/Goods/102742361\">http://www.yes24.com/Product/Goods/102742361</a></li>\n</ul>","frontmatter":{"title":"OPA(Open Policy Agent)를 이용하여 JIRA의 권한 구현하기","date":"September 26, 2024","description":"OPA(Open Policy Agent)를 이용한 JIRA의 권한 구현하기","author":"sunny"}},"previous":{"fields":{"slug":"/trino/"},"frontmatter":{"title":"오픈소스 Trino를 활용한 전사 데이터 분석 시스템 구축기"}},"next":{"fields":{"slug":"/locust/"},"frontmatter":{"title":"Locust를 활용한 부하 테스트 작성"}}},"pageContext":{"id":"f773079b-52cc-5d03-b130-9eeae28dcedc","previousPostId":"c9793497-3249-53d4-ac75-570a13b6eed3","nextPostId":"ed0bdd1d-ac7a-5245-a70b-7786b71a3b54"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}