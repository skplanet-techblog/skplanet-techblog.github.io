{"componentChunkName":"component---src-templates-blog-post-js","path":"/ios15-rendering/","result":{"data":{"site":{"siteMetadata":{"title":"SK플래닛 TECH TOPIC"}},"markdownRemark":{"id":"e788729a-7d49-5d36-9c6e-b7fdcfc740af","excerpt":"대부분의 동영상 어플리케이션에서 구현되어 있는 것처럼, V 컬러링에서도 동영상 렌더링 시 재생 전 회색 (또는 하얀) 화면의 노출을 방지하고자 배경에 미리 썸네일을 깔아 두는 구현 방식을 사용하고 있습니다.\r\n그런데 iOS가 1…","html":"<p>대부분의 동영상 어플리케이션에서 구현되어 있는 것처럼, V 컬러링에서도 동영상 렌더링 시 재생 전 회색 (또는 하얀) 화면의 노출을 방지하고자 배경에 미리 썸네일을 깔아 두는 구현 방식을 사용하고 있습니다.\r\n그런데 iOS가 15 버전으로 업데이트되면서, 이상하게도 썸네일에서 비디오 재생으로 넘어가는 그 찰나에 화면이 깜박거리는 현상이 발생하기 시작했습니다.</p>\n<p>한 화면에 한 영상만 로드되는, 특히 홈과 같이 크기가 작은 영상인 경우 별로 티가 나지 않았지만 플레이어처럼 전체 화면을 빠르게 스와이프하면서 영상이 바뀌는 경우에는 계속 깜박임이 발생하여 눈이 아주 피로했습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94ba467846835557c382c7840d81ff4e/4719e/home_player.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.9367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEv0lEQVR42m2UC1DUVRSH/9MU09QUZTWWpiRhSsVkvvKNkGIQECgoyUuBRI0hHqICOiAZjQPmIPHyTQ6k+KBFCFhXcWFBQWR5LK8FYZddWGRBByU1QL4Wi7VpujO/ueeemfvd35lz5grduh403XfoVGnQ9fby7zUyMsLwyLDxXNfQSH6hmMtXShBLrv6PShCGJDW0Z1yhJaeG2MhIVq92xMvTm317EnGx38qhg8eNwKZWJRJpKaUV15GWX+daWTlSWcXTeFylBglD5/pp+fUmSRcqsfZYywvPmTJt2nussd7AmyZWBAVEGIGqLg3VtXXIFQrkjU0o2m6jaG1DbnD+NKdoRFApOtG29xEtu4ZjiCdrPl2Fs50j9jbOzLVYQmpikhHY3XsHRYsSZaeaZmUzotxsCgtFtHWqaGnvMOg2gji/jCpZGVGyUwTt8mHV7EX4egURHboTd2d3jianG4G9+n6Uqi7aVWoiAr1Y85kVHnYLuZh9hK5ePW2GvJCZVUFWQS5xxzKJ99/CLNPJzLZchPUyB1Zb23E+6xcj8E7/AN36AYrERVjPm8OxHyJJiQwk1MsZdY+hsdoeBLVaR72imS6dHnn5DU4dOcnFiyIuXSpCXFxMe5vymcP+froH7nE28wTJe0IQZ6VwOmEvwesdaGhUoO3rQxgdHWFsbOzphYl9Ijbm/8npDCX3Dd4nPi6GtNhQpKfSyEtNwNthJRUyKbqBu+MOu6iWN6BoakGt0fLozxH+eDzM8PAoQw8e8fDhY+Mj48D++/fx2xRAgKc7FRmJxPlvxGLqFIouidA/GEJI+TGOY2GufL/Ng5iEdPafq+SMuIqwn7N5zS2MiAwREzb77t5D3a0lKCic+JgfyEuPY7uHG1Nef4vUpEOodDqEhOidnN/tTKyvPV7OTiQnJdFQ28i3GekILh74HHrWlL7BQepVPUiq2igoqeNsWjIRIVHMNLPAb6MnlQ2GsTkQvZvMMEdi/JxYt9qWkA12lF4r45uDaQg+PvidyTECtUo1VZKbyBp7kdZoyDlXzOEjuSxbsBSbhQu5ImtAiAoP53R8MGH+3mzd4MJen+W4rpqH/a5QBK/N+KQeNzZGU17L7YQMZPVayuo0iKV1XCiqZun8JXw0w5zDKZkI+3YEs32TL062NgSudyR57zbyMg8SEBGB8O4K/L+LMzps6NRTUNmBTN7FDUU3N1v1pB3NYfGc+XzywSwC/IIQ2hVyKsukdCpu0VQvp6a6mn7Dr9Pc2kluQQm1ihYjsLalB9HVBi5fb0NW00F5nZbY2J+weGcqVuYWfO3miTA29oRx/T17o4bSnvDfNTGeSoPDIkkdv4trKTM0RlqjIu24CFcHN9Z+4UJoeBzCVYmewrwuin/TUHxBS7XkAepboK6CVskovYpRI7jI4DCsqIaokibSCyvJzZdxNv8GJzNFxOxPIzE9F2GLn5ZA9w42rugg0KaH4OV6dhkUs0RP5PRe8nYMGoEnKmpxzi5k8YFkbN2/ZLPT5/iud2Wd7XxcHFyI3p+MYPLKFExmLuDF5ydhaohfMnmDSa9OxfTlt5k2+X38vLcYgTtDQ7E0M8PKbDofOn2FuZUVH1taYm4+AxublcydO4+/AMdpae0NPXp+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"home_player\"\n        title=\"\"\n        src=\"/static/94ba467846835557c382c7840d81ff4e/f058b/home_player.png\"\n        srcset=\"/static/94ba467846835557c382c7840d81ff4e/c26ae/home_player.png 158w,\n/static/94ba467846835557c382c7840d81ff4e/6bdcf/home_player.png 315w,\n/static/94ba467846835557c382c7840d81ff4e/f058b/home_player.png 630w,\n/static/94ba467846835557c382c7840d81ff4e/40601/home_player.png 945w,\n/static/94ba467846835557c382c7840d81ff4e/78612/home_player.png 1260w,\n/static/94ba467846835557c382c7840d81ff4e/4719e/home_player.png 1330w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>(왼쪽이 홈 화면, 오른쪽이 아래위로 스와이프하면서 전체 화면으로 영상을 볼 수 있는 플레이어 화면입니다.)</p>\n<p>V 컬러링은 기본적으로 모든 영상이 자동 재생되고 있습니다.\r\n그런데 iOS의 경우 정책상 사용자가 액션을 취하기 전까지는 무조건 음소거 모드로 동영상 재생을 하도록 되어 있는데요,\r\nV 컬러링은 사용자가 한 번 소리를 켜면 스와이핑을 해서 다음 영상으로 넘어가더라도 똑같이 소리 재생 모드가 유지되어야 하기 때문에 안드로이드와 동일한 구조로는 구현할 수 없는 이슈가 있었습니다.</p>\n<p>그래서 안드로이드와 iOS를 구분하여, 안드로이드는 스와이퍼 내부에 비디오를 위치시키고 iOS의 경우 껍데기 정보와 썸네일만 스와이퍼 내부에 둔 채 비디오 영역은 바깥으로 분리하여\r\n스와이핑이 완료된 이후에 동영상을 따로 로드하여 소리를 재생시키는 우회적인 방법을 사용하고 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6dee09eb820f26de317e2db4343e202f/5d72a/player_source.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVR42m2UCY+bMBSE8/9/WquqUrdNm2NDIBzGXAYMmHM6dpJuVmqiUYwx35t3kN22rvAOR/z58Qb/fEYWx8A8YZvGz+IeltndWyfDa8P1+JC5a9uw2+YF8nxBTGjmedCpwNo2d+kGm1XXYGoqdIWEUTlgNLbe7qsXVcC6EEjq7XbD4UhgUcBev36e13VdY/9rj/PlAiEluq7D/z47e3zWLaa+w8TUppHpbavTyojrsmDj12iNrizREJzJDJoZjKOBGXoMD9ngOxe9KiDDEGl4RRR5KEWKVERomxJDz2CsmW5qyDhCHodIoitykSBPYpRFSmiLtlWY5/me8jB0jBoRckIirkj5UJGndFMSVDoXPTOoGFjEZ6Z8ITRAkSVQ3NOEtTz7D2gItG6y1EOWxahY/DwTDtixGRbYda1zW8iAwW+EpTwfu8B3YPHi0BCoStavdykIESIKfdwCD31Xc1pGdD1r2NaUguH5YdBO5iGt6zvQ1lATVucZVFkwqmA33/Dt6xccD3vn1jZAE1Zn0kF7jpGVdWxh9rdt1Adw5cJ2KQreIVMfqpZomoxumbpMUBQZ9wXE5QQlUyhVuHKEt6sLahWzpgsnYvecn3makcgzAvFGQIyaA1zzQetEVSUhFZL0N4JgD987IfDfXUksyMIb1voTcLJANsUX3xEnHg9fXWOMIdCWpFZIqxP8+Ce8y5Eg36VqNfLN6V5r6IDjxGZwFMrEda5ic1SVE5bSsURV2vGo3IP6UUe7fso6/ARc+Seh25Y3bcfaD3Gv73v3Fhkz0I1xel0/tcwz/gKq9S6bVa6PuQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"player_source\"\n        title=\"\"\n        src=\"/static/6dee09eb820f26de317e2db4343e202f/f058b/player_source.png\"\n        srcset=\"/static/6dee09eb820f26de317e2db4343e202f/c26ae/player_source.png 158w,\n/static/6dee09eb820f26de317e2db4343e202f/6bdcf/player_source.png 315w,\n/static/6dee09eb820f26de317e2db4343e202f/f058b/player_source.png 630w,\n/static/6dee09eb820f26de317e2db4343e202f/5d72a/player_source.png 834w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>처음 이슈를 발견했을 때 저는 이러한 구조적 차이점에 원인이 있다고 판단해서, 안드로이드와 iOS의 서로 다른 구현 방식을 분석했습니다.</p>\n<p>구현되어 있는 구조를 간단히 설명하자면, 안드로이드는 스와이퍼 내부에 비디오를 컨트롤하는 컴포넌트를 넣어 현재 보고 있는 영상 직전/직후의 썸네일을 미리 받아와서 스와이프를 할 때 보다 빠르게 화면에 렌더링을 하는 반면,\r\niOS는 안드로이드와 같은 구현 방식을 사용하면 재생 시 자동으로 음소거가 되어 버리는 문제점이 있기 때문에 비디오를 컨트롤하는 영역을 따로 분리해서 스와이프가 된 이후 하나씩 영상을 재생하며 소리를 켜는 방식을 사용하고 있습니다.</p>\n<p>그래서 iOS를 안드로이드와 동일한 방식으로 구현해 보기도 하고, 재생되는 시점의 데이터를 하나 하나 확인해 보며 원인을 파악해 보려고 애썼지만 어떤 방법으로도 해결이 되지 않았습니다.</p>\n<h3>스와이핑 중 썸네일 제거 및 onLoadedData 상태값 변경</h3>\n<p>여러 가지 방법을 시도해 보다가 slide change event가 일어나는 시점을 살펴보았습니다.</p>\n<p>사용자에게 아무것도 렌더링되지 않은 화면을 보여주지 않기 위해 현재 스와이핑이 되는 과정, 즉 slide change event가 일어나는 시점에도 썸네일을 배경으로 보여주고 있었는데요,</p>\n<p>이미지에서 동영상으로 전환이 되는 시점에 리페인팅을 하는 과정이 잘 처리되지 못하는 것이 아닌가 하는 생각이 들어, 스와이핑 중일 때는 썸네일을 제거해 보기로 하였습니다.\r\n그랬더니 배경이 사라지면서 조금 덜 버벅거리는 느낌은 있었지만, 여전히 비디오가 재생되는 시점에서는 깜박임이 발생하였습니다.</p>\n<p>이번에는 비디오 로드의 초기 상태값을 변경해 보기로 하였습니다. iOS의 경우 처음에 로딩 상태를 나타내는 값이 false로 되어 있고, 비디오의 <code class=\"language-text\">onLoadedData</code> 속성에서 해당 상태값을 true로 바꿔주며, slide change event 발생 시 다시 로딩 상태를 false로 바꿔 주고 있습니다.</p>\n<h4>onLoadedData</h4>\n<p><code class=\"language-text\">video</code> 태그가 완전히 로드될 때 javascript를 실행하는 이벤트 요소</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span> <span class=\"token attr-name\">onLoadedData</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{setLoaded}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>(참고) 비디오 로드 순서 (출처 : w3cschool)</p>\n<blockquote>\n<ol>\n<li>onloadstart</li>\n<li>ondurationchange</li>\n<li>onloadedmetadata</li>\n<li>onloadeddata</li>\n<li>onprogress</li>\n<li>oncanplay</li>\n<li>oncanplaythrough</li>\n</ol>\n</blockquote>\n<p>HTML의 기본 태그인 video의 속성 중에는 <code class=\"language-text\">onLoadedData</code>라는 값이 있는데, 이름으로도 알 수 있듯이 이 값은 비디오가 정상적으로 로딩되었는지의 여부를 판단합니다.\r\n원래는 이 <code class=\"language-text\">onLoadedData</code> 속성 값에 따라 썸네일을 보여줄지 비디오를 보여줄지 여부를 판단하고 있었는데,\r\n최초 렌더링 시에는 당연히 비디오가 로드되지 않은 상태였기 때문에 해당 상태의 초기값은 false였습니다.</p>\n<p>그리고 비디오가 로드되면 상태 값이 true로 변경되면서 브라우저의 화면을 다시 그리는, 즉 앞에서 설명드린 repaint 과정이 수행되는데요,\r\n이렇게 그림을 다시 그리는 과정에서 깜박임이 발생하는 것이 아닐까 하는 추측에서, 비디오 로드 상태의 초기값을 우선 true로 바꿔 보았더니 마침내 화면이 깜박이는 현상은 사라지게 되었습니다.</p>\n<p>썸네일이 사라졌기 때문에 로딩이 느린 감은 있었지만, 그래도 깜박이는 현상이 해결되었기 때문에 결국은 위 두 가지의 조합을 통해 문제를 해결한 것으로 일단락을 지었습니다.</p>\n<h3>가로형 영상인 경우에만 스와이핑 중 썸네일 노출</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//변경 전</span>\r\n<span class=\"token operator\">&lt;</span>Swiper <span class=\"token operator\">...</span><span class=\"token punctuation\">{</span>swiperParams<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token operator\">&lt;</span>Player<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>firstFrame<span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token string\">\"thumbnail\"</span> <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Player<span class=\"token operator\">></span>\r\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Swiper<span class=\"token operator\">></span>\r\n\r\n<span class=\"token comment\">//변경 후</span>\r\n<span class=\"token operator\">&lt;</span>Swiper <span class=\"token operator\">...</span><span class=\"token punctuation\">{</span>swiperParams<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token operator\">...</span>\r\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Swiper<span class=\"token operator\">></span>\r\n<span class=\"token punctuation\">{</span>isIOS <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>loaded <span class=\"token operator\">&amp;&amp;</span> direction <span class=\"token operator\">===</span> <span class=\"token string\">'HORIZONTAL'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>firstFrame<span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token string\">\"thumbnail\"</span> <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n  <span class=\"token operator\">&lt;</span>VideoForIOS <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 이렇게 썸네일을 보여주는 과정을 생략하니 비디오가 재생되기 전에는 검은 화면이 노출되어, 깜박이는 현상은 사라졌지만 뭔가 화면이 굉장히 느리게 렌더링되는 느낌을 지울 수가 없었습니다.\r\n특히 너비가 더 긴 가로형 영상인 경우 원래부터 위아래가 검은색 배경이라 크게 느리다는 느낌이 없었지만, 길이가 더 긴 세로형 영상의 경우 전체 화면이라 시각적으로 주는 효과가 더 크게 느껴졌습니다.</p>\n<p>이번에는 썸네일의 위치 및 보여주는 시점을 변경해 보기로 하였습니다.\r\n우선 원래 스와이퍼 안에 있던 껍데기 컴포넌트에서 안드로이드와 iOS 공통으로 사용하던 썸네일을 스와이퍼 외부에 따로 빠져 있는 iOS 비디오 영역으로 이동시켜 보았습니다.</p>\n<p>그리고 이미지 위치를 옮긴 후 비디오의 로드 상태값을 다시 원복시켜, 로드가 되지 않았을 때는 썸네일을, 로드가 된 이후에는 비디오를 보여주도록 변경해 보았더니 여전히 깜박거리는 현상은 있었지만 이전보다는 훨씬 개선이 된 느낌이었습니다.\r\n어떤 부분에서 개선이 된 걸까 테스트를 해보다 보니, 세로형 영상에서는 개선이 되지 않았지만 가로형 영상에서는 깜박이는 현상이 바로 해결되고 아주 매끄럽게 화면 전환이 일어나는 것을 확인할 수 있었습니다.</p>\n<p>그래서 데이터를 기준으로 가로형 영상과 세로형 영상을 구분하여 가로형은 기존과 같이 썸네일 로드 후 비디오를 재생하도록 처리하였고,\r\n세로형은 썸네일을 제거하고 비디오를 바로 로드하도록 처리하였습니다.\r\n이렇게 했더니 가로형 영상에서는 깜박이는 현상은 사라지면서도 썸네일이 아예 보이지 않을 때보다는 훨씬 빠른 것 같은 느낌을 받을 수 있었습니다.</p>\n<h3>object-fit</h3>\n<p>하지만 여전히 어딘가 찜찜했던 마음의 빚을 해결하고자 문제를 다시 한번 들여다 보았습니다.\r\n자바스크립트 영역에서는 이제 할 수 있는 방법을 모두 동원해 보았기 때문에 이번에는 style 속성을 살펴보면 어떨까 하는 생각이 들었습니다.\r\n가로형에서는 잘 되는데 세로형에서만 문제가 발생하는 원인이 뭘까 곰곰이 생각하며 두 타입의 스타일 속성을 하나하나 비교해 보니\r\n<code class=\"language-text\">object-fit</code>이라는 속성의 값이 서로 다르다는 점을 알게 되었습니다.</p>\n<p>css의 <code class=\"language-text\">object-fit</code> 속성이란, 요소의 크기에 맞게 <code class=\"language-text\">&lt;img></code> 태그와 <code class=\"language-text\">&lt;video></code> 태그의 크기를 조정하는 방법으로 사용되는 속성입니다. 기본적인 속성 값은 다음과 같습니다.</p>\n<blockquote>\n<ul>\n<li><strong>fill</strong> : 기본값이며 요소의 크기에 맞게 꽉 채워서 보여줍니다. 크기가 늘어나거나 찌그러집니다.</li>\n<li><strong>contain</strong> : 요소의 가로/세로에 맞춰 크기가 조정되고, 비율은 고정입니다.</li>\n<li><strong>cover</strong> : 요소의 가로/세로에 맞춰 크기가 조정되고, 비율은 고정입니다. 가득 채울 때까지 확대됩니다.</li>\n<li><strong>none</strong> : 원본 사이즈로 처리됩니다.</li>\n<li><strong>scale-down</strong> : none과 contain 중 대체 콘텐츠의 크기가 더 작아지는 값을 선택합니다.</li>\n</ul>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1ce333b63790255ce396338555cee72a/f3c12/objectfit_fill.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTklEQVR42pWSTUhUURzFH9GihavWIqhB4CZBbNEmMAJb6CIQwVoGRcQotMlFC6kw+rBFC4sWKgVFRSE2CikRM2qioTOOTjO2CdQaZ+Z9zbz35n2Nv+57Tu67cOBeLpz7O+f+pUI+j6ooFAt5dE1lf3+f/13VapVyqUTV95FyqklONcgpBnuahWr5h1KEdLuK53niMR1d1dAMA1XXkX/topVNNFlDlRVkcWc7LtJOTuZPUScnl9hTyuiWh2a6NTnkjCqmZZPOZNnYSJOIfiE5Ms7C2V4WI7dYunmXteVVFj/PUtjZQdot6Ad0gjTY5wNK00MxXOSygyEIbdtmI50h8fw18TPdRE+18+x4HRPNDXy9MsDU7Tu8u/+A1NwskiJwSyJC0IFclDFFDN/18AS+azuilwPDVGKdxMQHYhf6mL3ez8dIP48bWhhoOcnQiSYetp5mIfoJaS9fQFG0UMWiQqXiHMoSUT3Px67YrG+mWX46Tqyjh8mmJmYu9jLV1cNIfT3Xmhs5f+wo89NRQaio6HoplCaKtwWVI+gCBXtfEFYqFdZF5JWxN3zr6GOms5MXbe0Mt7Xy6FwHT25EiFy+xMp8HEmWVWFUqknHFXFt2w0VUP4zXF1Lspba5Pv0HLHBe4w1NjNUd4TRrm5GBwd5+/IVv7e3A0Pl0DCInc8Xw6iu64emfq3DTGaLbPYnP7JbJN9PsjQ0TPxqhEQsTlI8lBQd6+IvapH1MLKqBl2qGIaJaVqhLKsSGgaUoYKzGH5HzL8jhtp2HNHxwZ3jOPwFU6K1rtLf9sYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"objectfit_fill\"\n        title=\"\"\n        src=\"/static/1ce333b63790255ce396338555cee72a/f058b/objectfit_fill.png\"\n        srcset=\"/static/1ce333b63790255ce396338555cee72a/c26ae/objectfit_fill.png 158w,\n/static/1ce333b63790255ce396338555cee72a/6bdcf/objectfit_fill.png 315w,\n/static/1ce333b63790255ce396338555cee72a/f058b/objectfit_fill.png 630w,\n/static/1ce333b63790255ce396338555cee72a/f3c12/objectfit_fill.png 764w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dca435d72de2e2b08d8429bc693f5ae8/17a7a/objectfit_contain.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB80lEQVR42p2Sv2sUQRzF9w+wEGKl2KSwEyyEaySVYGcaDdrZCSqIaKGSUg40IEJQomCVTsRC0BP8UaQIHBwhORGMCop6593O7uzszOzu7OzePr+7l7tsLB14zMDMfOZ933wdzjkYY5jMxhj8z0iSBFEUwTEmgVYKkdaVbJoiz7N/lKMoiuqiSQxCpSGkRMhJId0lWHkmyzI4fqDwe+CB0cx8CaHpgSSDiu1UdSDzfHQ3u9hceor1c5fQWX2OT1tdYDSq9p0ej9BjAkOuMSD1WAhfpeDaVvKURZjkdHQMdIVA594KXh45itXZw2hdvYnWymMUeT4G/vQUfvR99H2FX67A9z65lQY+wUoxAvK4BqSs23eW8f7CRTw6eQo3Dh3Ek4Xz4yCpCicQEv2BCz8I4XocgjKJjaVc0qnqJbtBgPXmMt4ca6B1+gyuH5jBlbkTOzwCagqY8wCqDFqE9DER0tTuUR04FAHazYdoNebwoHEczfl53L19a9ehlBoeBV3+FueCvj6BtTm1QUotZCvVgX8GQ3Q2trC22MTS/n24v3AWb1+93nVYAhnzyV3ZApLWXuW4dGZMWmlPya6Lj9tfsPHsBdYuX0P73Qd8/vpt2o9OHCeQUpEjQ+7iCqqp7CzLpxrttEQ5yrW15HpUIKc3JmcmwL+FstzlTh9csgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"objectfit_contain\"\n        title=\"\"\n        src=\"/static/dca435d72de2e2b08d8429bc693f5ae8/f058b/objectfit_contain.png\"\n        srcset=\"/static/dca435d72de2e2b08d8429bc693f5ae8/c26ae/objectfit_contain.png 158w,\n/static/dca435d72de2e2b08d8429bc693f5ae8/6bdcf/objectfit_contain.png 315w,\n/static/dca435d72de2e2b08d8429bc693f5ae8/f058b/objectfit_contain.png 630w,\n/static/dca435d72de2e2b08d8429bc693f5ae8/17a7a/objectfit_contain.png 753w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5511ee18bd52b869b1ba103d980de0bb/17a7a/objectfit_cover.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZ0lEQVR42p2SS0hUcRyFb9CijbQJJVAToTZhahoSbYIi7EHYqhYiFEn0gBSEopWbiRCsNpWiJJhOTugipI1JmVpR+ShnUKdCxdLxzsydmfuae+88/PrfCYS2/eGDezeH8zvnSLIsE4vFiETCJBJx/udls1kM02RzcxPJMAxM8WMYJpZlkU6n/yGTyZBOpYmrKjFDJ/z2PfLoOD8HXxAc9KKMfmTp8zTLwSDRpWWkcDgqHCaEOw1V1bHt1BaW5QjRDJZt45/zM+PpZKzmBM+KC2iTJDqKinjT2oavoZGh9odM9vcjxYWYmlDRNZ2YEscUTh0h5mILwYwQtB0H/+wcX662MlZ+nJGWFnpbmrhXuJfWynLuV1bQXlbNcE8P0qqcYE3RWVcMVuU4G3GTqJ7KEdEcdDsrhC0C84sEVlb4cLGZT5duMfWggyel5dTl7aC5KJ/bebt41d2F9HsjynokQSiqsR4Wp5spQTqHKr43dBF40ibgDzDVMcD4mQaGdhfysuYIk3X1dBfv4bwQPZe/k5G+XqRfwtWaEMsRUVGEM8X4S1R30GyRoWUzN7/AZP1NJipq8ZUW0HvsKH2Nl/FWVtF1oYH927fh6+oUGSoxNJGhKlrUVI2syCztpHKkbIesaNlKJvm2sMj06DsmDp3ldcVhnu4r405JCdeqD+JpauLKqVqGfc+RImEFRZThthyJKIRCspiRlWs4KU5NicnYouWF4HcCs36+eh4z0zeA9/RJHlUdYOjGdbx3PfgXfyCHQu4Ok7mTXEwzmcMVcefikslkc4PdQgzZJevYpG2LlKaREaW5e3XfHw8GoZjaIL2bAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"objectfit_cover\"\n        title=\"\"\n        src=\"/static/5511ee18bd52b869b1ba103d980de0bb/f058b/objectfit_cover.png\"\n        srcset=\"/static/5511ee18bd52b869b1ba103d980de0bb/c26ae/objectfit_cover.png 158w,\n/static/5511ee18bd52b869b1ba103d980de0bb/6bdcf/objectfit_cover.png 315w,\n/static/5511ee18bd52b869b1ba103d980de0bb/f058b/objectfit_cover.png 630w,\n/static/5511ee18bd52b869b1ba103d980de0bb/17a7a/objectfit_cover.png 753w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/19189858dacf7cc7753f7358ea1ecdd2/c483d/objectfit_none.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcUlEQVR42p2ST0gUYRjGJ4j+gJWHLoWsYKgHwbVDapRWJlIiSniQKMEQEiIvYVDRpU5SipAigWGYJBkhBCuWlJhpZHZIg6LW0k3N3Z11d2Z2x9mZ2fXXNxsUXfvgx/ucXp7veR8pEAgQiURwpqIo/O/T4waWbSHFYjq/iWEYBrZt/8WySCQSJOwE8vQc8thbFkc8fBnoxTvYz/cnj1mYnEIOBvnqGUaV15ACgSDhsCJcqqiqhmnaxONWCsMwsZMbmGqU6ZqLTJedZahgP30Vh7mZm0nXtjQ6C4rpPV1Ht2sfL7o6kZxFmhZLuXS0rhv/LLQs4TSZZHbQw1RVI+N5ZcwNjzE995E29wEuZeTQvHsX53Zup6+hASkYDInsNBThztFaVHzdNDHiJutGXOSSwBL6k/8nH8YnGcs+xFTTdd63tjNeWssNVxbH0rbSkraZO03nkUKyjBJRUBWVSDiCZVp/MMWihMjSSiaYFa5mLt9mNNuNJ8fN0+xcnhWdYLLwKG2uvVRt2cTdxnoknz/MsqyxEoqmZihqCqwUsmYSNpIYus5EZSMT+ad4XniEnnSJhyUHeXW/l+HKGkYys2jZkc6V+jNIK/41/CGN1ZAqpko0nkTV7RSabuHXbNY3YKajm/H847wuLGMoL5PuPRncO1nN1RwXHeUVjLZ3MtB6C+lHIMKKcLa6FmMpqOBbDSOrccIx4VI4jBoiQ1GfzwuLvGm6xruSOl6WlvPAXUR/dS3NWS4uFBfSVFPFo54eJFWUWRcX1kUPNXEYJ0snP6d7DknRw6S4stPR2HIA49sSMZ8PeX5e4CXi9aIFZELLS8Qti1/UeI/MKkqRvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"objectfit_none\"\n        title=\"\"\n        src=\"/static/19189858dacf7cc7753f7358ea1ecdd2/f058b/objectfit_none.png\"\n        srcset=\"/static/19189858dacf7cc7753f7358ea1ecdd2/c26ae/objectfit_none.png 158w,\n/static/19189858dacf7cc7753f7358ea1ecdd2/6bdcf/objectfit_none.png 315w,\n/static/19189858dacf7cc7753f7358ea1ecdd2/f058b/objectfit_none.png 630w,\n/static/19189858dacf7cc7753f7358ea1ecdd2/c483d/objectfit_none.png 751w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d8fd8d5b7e0a121732585acdc7b620f7/17a7a/objectfit_scaledown.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVR42p2SvWsUQRjGz8I/QQI2ViL4BwixEPwglSCIzYEIItgpiNgEkoCNlRY21iKkUFCIkkYO0SSwCXJwJqJHJBZuYnZ2d3Zndvb2c/bxnbnkzghpXHjYWead5/09+06LMQbOOXyfIYoi/M/TNA2EEKjrGi2lFJQakFJkWYaqqg7IFGmt7SHzFrFAlCqEXoA4TghCoKA6TXWmpsVYQIQxbUrqkqAoKuR5aZVlJcqyokJtSSpa97d+ove2g9X2XTj35rD6/iPY9vaItLVvJmWCMIws7aGGdOC708Xy5et4fvwY3lyawuuZh+g7ztCQEpBhZMmShGKE3EbP88Iqy/J/DDW+rXzG8o07WLh1G7OnTuP+xAS6C+/svol9IHIYxiO6wwi/EmFn6hoWz13APOnK0SPovHo5NuREJWlCUtA/jGMURFYW5VBkagZjhrFPuLFGka/exIvJSTy5eB7T7TacpU9DQxN5h3EwLuGFRgIq15CD0kqkRFmMCU2Tjf4muosfMH/mLB6dPIFns3NwXXc8FHc3hMti7AQSvzyOLZfBFxm4qhCpAr9ljbLeIyTa/uYPrHd7WHowg5XHT7HW+4LAD8aGXpTCl7mVFw+wS988JbNBbcUzjVo3o0tsYmlq0OwZaNpr/rrkfwDujdzgWKFdKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"objectfit_scaledown\"\n        title=\"\"\n        src=\"/static/d8fd8d5b7e0a121732585acdc7b620f7/f058b/objectfit_scaledown.png\"\n        srcset=\"/static/d8fd8d5b7e0a121732585acdc7b620f7/c26ae/objectfit_scaledown.png 158w,\n/static/d8fd8d5b7e0a121732585acdc7b620f7/6bdcf/objectfit_scaledown.png 315w,\n/static/d8fd8d5b7e0a121732585acdc7b620f7/f058b/objectfit_scaledown.png 630w,\n/static/d8fd8d5b7e0a121732585acdc7b620f7/17a7a/objectfit_scaledown.png 753w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>(출처 : <a href=\"https://developer.mozilla.org/ko/docs/Web/CSS/object-fit\">https://developer.mozilla.org/ko/docs/Web/CSS/object-fit</a>)</p>\n<p>이렇게 다섯 가지 값이 있는데, 기존 코드를 살펴보니 가로형 영상인 경우 <code class=\"language-text\">contain</code> 값이, 세로형 영상인 경우 <code class=\"language-text\">cover</code> 값이 적용되어 있었습니다.\r\n<code class=\"language-text\">contain</code>과 <code class=\"language-text\">cover</code>은 둘다 모두 가로/세로 비율에 맞게 크기가 조정되지만, 차이점은 <code class=\"language-text\">cover</code> 속성인 경우 화면을 가득 채울 때까지 확대됩니다.</p>\n<p>V 컬러링 정책이 가로형 영상은 너비에 맞추기만 하면 되지만 세로형인 경우 풀 화면으로 보여줘야 한다는 것이었는데요\r\n이에 따라 가로형 영상은 너비만 맞으면 되었기 때문에 <code class=\"language-text\">contain</code> 값을 사용하는 것이 가능했지만\r\n세로형 영상은 <code class=\"language-text\">contain</code> 값을 사용하게 되면 가로 너비가 비어버리기 때문에 요건을 충족하지 못해 <code class=\"language-text\">cover</code> 값을 사용하고 있던 것이었습니다.</p>\n<h3>로드 시점에 object-fit 값 변경</h3>\n<p>이에 <code class=\"language-text\">object-fit</code> 속성의 값이 <code class=\"language-text\">cover</code>일 경우 iOS 15에서 썸네일과 영상의 변환 과정이 자연스럽지 못하다는 추측을 통해, 비디오의 <code class=\"language-text\">object-fit</code>의 초기값을 <code class=\"language-text\">contain</code>으로 바꿔 보았습니다.\r\n역시나 예상대로 가로형과 같이 깜박거리는 현상이 사라지고 매끄럽게 영상으로 전환되는 모습을 볼 수 있었습니다.</p>\n<p>문제의 원인이 <code class=\"language-text\">object-fit</code>이었다는 것을 깨닫고 썸네일 속성도 역시 <code class=\"language-text\">contain</code>으로 바꿨더니 위화감이 없어졌고\r\n따라서 iOS 15 버전에서는 <code class=\"language-text\">object-fit</code>의 <code class=\"language-text\">cover</code> 값을 제대로 처리하지 못한다는 결론을 내릴 수 있었습니다.</p>\n<p>하지만 이렇게 해도 여전히 문제는 남았습니다. 세로형의 썸네일과 비디오 속성을 contain으로 해 버리면\r\n풀 화면을 채워야 한다는 기획요건에 부합하지 못하고 너비가 양쪽으로 남게 되는 현상이 발생했기 때문입니다.</p>\n<p>어떤 방법이 있을까 한참 동안 생각해보다가 순간, 초기 값은 <code class=\"language-text\">contain</code>으로 하되 비디오가 로드되는 시점에 <code class=\"language-text\">cover</code>로 변경을 하면 어떨까? 하는 아이디어가 떠올랐고\r\n그렇게 했더니 마침내 세로형 영상에서도 깜박이는 현상 없이 자연스럽게 썸네일에서 동영상으로 전환되는 모습을 확인할 수 있었습니다. 😎</p>\n<h3>스와이핑 중 썸네일이 사라지는 side effect 발생</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e31539e2baa01514fbb433244e31632/a357c/sideeffect.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC50lEQVR42lXSfUxTVxjH8dsWk1VNjGGELDH+sfifMZHMLMvmiCELNhDEZdEGhiuJTIzKYkBB40sAYwHFWkWgA1soF2VZ167SwCAswCYuxqUsU6xFYWyABUWLQHlpefnu9gaIPifnPn+dT55zf0dI02STptnP14kaErbu5eiXWdhtdqKiooiMjCQ6Ohq1Wo1WqyVcoVCQ8fHXTE9PMTc7zay05+ZmmJF6IDCJcGh3JnkHtJz6ajcnNn1M3o69NFjrUSiVCIKASqWSu0ajkcHFhQVmZwL4ng/R96wXr/cJnl4vA4P/EQrOIuSm5nAyI5vbunTEbbHkfRTPD2I9qogIFBKkXIYzMjJYqcWFRSxmM8aya1RWV1Gov8j5/Hwmp6YQ4rLNxOTYiPs0hc8+jCUuVoe1VlyFVrpOp1sFA4EAv3d20Nneinizgod/uxHrrIyNjSEUnijheOpBjutOcmzfIQq+K8Xxo53NH0SxTv0ea9euk8Hk5GSWpBUKhfD7/XT/1Y31hoHc1D10dbZxx/kzL0ZGEf6pMOLVF+AtLsCjz2fUXE57awufaE+xZfsXbNywXgaTkpLk6YLBIG8mJnB3u2kwXSc7ZQ+/NDppbWlmxOdD6Kuu5PFlPb1XL+EpLcJXZ6HJ1Yg65nMi3t+EUsLCYEJCwuqV5+bncbe186uzhfwCPWKDC7ujCd/wMILXVMajogt0nDvNvcJzjIoWmh0OGQmHEiGF83bK4ZqXknY/eMiDrj/5reMuTumZWUUnw4NDCPrDR3lUUsTdinKcV0v4o1RPuzShoFTJgaxZBlcmXFpaCn+5/6SfcnsrtVX1OM3fc7PsCq/GXiLE79xFXvo3FBdfIjNdR1piPLZbtxEUCglSSO/w3QllUNr3PY8xVJk4c+RbinKPYTibxctR6R/WWCyYamoRbT9RW1ODzW6np6cHo8FApbUOU1U1RqMRl8vFsiijg/19DPV6GOp/xsi/AzyVzoz7/fwPRnpO692UfIwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sideeffect\"\n        title=\"\"\n        src=\"/static/8e31539e2baa01514fbb433244e31632/f058b/sideeffect.png\"\n        srcset=\"/static/8e31539e2baa01514fbb433244e31632/c26ae/sideeffect.png 158w,\n/static/8e31539e2baa01514fbb433244e31632/6bdcf/sideeffect.png 315w,\n/static/8e31539e2baa01514fbb433244e31632/f058b/sideeffect.png 630w,\n/static/8e31539e2baa01514fbb433244e31632/40601/sideeffect.png 945w,\n/static/8e31539e2baa01514fbb433244e31632/78612/sideeffect.png 1260w,\n/static/8e31539e2baa01514fbb433244e31632/a357c/sideeffect.png 3854w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 완전히 이슈를 해결했다고 생각하고 있었는데 어느 순간 스와이핑 중 썸네일이 사라지고 있다는 사실을 발견하게 되었습니다.</p>\n<p>안드로이드의 경우 스와이핑을 할 때 이전 영상의 썸네일과 이후 영상의 썸네일이 모두 보이면서 자연스럽게 화면이 전환되고 있는데,\r\niOS는 스와이핑 중에는 썸네일이 보이지 않고 검은 화면이 노출되고 있었던 것입니다.</p>\n<p>문제를 해결하였던 과정을 다시 하나씩 살펴보니 썸네일의 위치가 최초에는 스와이퍼 내부의 껍데기 컴포넌트에 있었으나, 중간에 스와이퍼 외부에 있는 iOS용 플레이어 위쪽으로 이동한 것을 찾을 수 있었는데요,\r\n앞서 말씀드렸던 것처럼 iOS 비디오는 음소거 이슈 때문에 스와이퍼 외부에서 따로 동작하고 있기 때문에\r\n이미지까지 이쪽으로 빼버리면 스와이핑 시 썸네일이 보이지 않는 것이 당연한 일이었습니다.</p>\n<p>어차피 문제의 원인은 <code class=\"language-text\">object-fit</code>이었다는 것을 알게 되었기 때문에 이미지를 다시 스와이퍼 내부로 이동해 보았더니,\r\n슬라이드 전환이 끝나기 전까지는 기존 영상의 썸네일이 그대로 남아있는 것을 확인할 수 있었습니다.\r\n우선 까만 화면이 보이는 것보다는 훨씬 안정적인 느낌이었지만 그래도 안드로이드처럼 스와이핑 중 다음 영상으로 썸네일이 변경되지 않았기 때문에 완전히 해결되었다고는 볼 수 없었습니다.</p>\n<h3>스와이핑 시 현재 영상과 다음 영상의 연결이 자연스러워지도록 수정</h3>\n<p>다시 문제 해결 과정을 천천히 들여다보니, 제일 처음에 깜박임 이슈를 처리하던 과정에서 스와이핑 중 보이던 이미지를 제거해 버렸다는 사실을 알게 되었습니다.\r\n<code class=\"language-text\">object-fit</code>이 원인이라는 사실을 알았을 때 다른 방법들을 제거했어야 하는데 그러지 못하고 그대로 두었던 것이 화근이었습니다.</p>\n<p>그래서 원래 비디오 로딩 여부로만 체크했던 썸네일과 비디오 렌더링 처리에 스와이핑 중이라는 상태값을 함께 체크하도록 처리했더니,\r\n깜박이는 현상도 해결되고 스와이핑 중 썸네일이 사라지는 현상도 모두 해결이 된 것을 확인할 수 있었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// image</span>\r\n<span class=\"token operator\">&lt;</span>Swiper<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>loadedForIOS <span class=\"token operator\">||</span> moving<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>firstFrame<span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token string\">\"thumbnail\"</span> <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Swiper<span class=\"token operator\">></span>\r\n\r\n<span class=\"token comment\">// video</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token literal-property property\">objectFit</span><span class=\"token operator\">:</span> <span class=\"token string\">\"contain\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"cover\"</span> <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>direction <span class=\"token operator\">===</span> <span class=\"token string\">\"HORIZONTAL\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"contain\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"cover\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>direction<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> loadedStyle <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>loaded <span class=\"token operator\">&amp;&amp;</span> moving <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> objectFit <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">\"none\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>loaded<span class=\"token punctuation\">,</span> moving<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token operator\">&lt;</span>video\r\n  className<span class=\"token operator\">=</span><span class=\"token string\">\"contain\"</span>\r\n  style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>loadedStyle<span class=\"token punctuation\">}</span>\r\n  onLoadedData<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setLoaded</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n  <span class=\"token operator\">...</span>\r\n<span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>iOS 15.5 추가 이슈 해결</h3>\n<p>이번 대응을 통해 덤으로 해결한 이슈도 있습니다. 원래 플레이어를 제외한 다른 작은 영상에서는 화면 깜박임 이슈가 없었는데요, iOS가 15.5 버전으로 업데이트되면서 <code class=\"language-text\">object-fit</code> 속성을 처리하는 과정에서 또 변화가 생겼습니다.\r\n<code class=\"language-text\">object-fit</code>의 <code class=\"language-text\">cover</code> 값을 사용하고 있는 모든 비디오에서, 썸네일에서 영상으로 전환되는 시점에 너비가 변경되는 이슈가 발생한 것입니다.</p>\n<p>네이버나 틱톡 등 다른 동영상 플랫폼에서도 현재까지 나타나는 현상인데요, 썸네일에서 동영상으로 전환되는 과정에 너비의 사이즈 변화가 발생하는 모습을 볼 수 있었습니다.\r\n이렇게 모든 영상에서 약간 부자연스럽게 화면이 튀는 모습이 나타났으나, 플레이어 화면에서 해결했던 방법, 즉 <code class=\"language-text\">object-fit</code>의 초기 값은 <code class=\"language-text\">contain</code>으로 세팅하되 비디오가 로드되는 시점에 <code class=\"language-text\">cover</code>로 변경을 하는 방법을 사용함으로써 이번 이슈도 자연스럽게 해결할 수 있었습니다.\r\n현재는 동일한 너비로 자연스럽게 전환됩니다.</p>\n<h3>iOS 16.0 추가 이슈 해결</h3>\n<p>iOS 16 버전이 업데이트되면서 잘 되던 방식에 또다시 문제가 생겼습니다. 15 버전으로 처음 업데이트 되었을 때처럼 비디오가 깜박거리기 시작한 것이죠.\r\n다행히 이번에는 문제의 원인을 잘 알고 있었고, 비디오의 구조 또한 완전히 파악하고 있었기 때문에 접근 방법을 쉽게 찾을 수 있었습니다.</p>\n<p>우선 깜박거리는 현상을 제거하기 위해 기존에 <code class=\"language-text\">display: none</code>으로 처리하던 부분을 <code class=\"language-text\">visibility: hidden</code>으로 변경하였습니다.\r\n그 이유는 <code class=\"language-text\">display</code> 속성의 경우 그 값에 따라 <code class=\"language-text\">block</code>인 경우 DOM에 영역 자체가 생겨나고 <code class=\"language-text\">none</code>인 경우 사라지기 때문에,\r\n값이 변경될 때마다 높이값을 새로 계산하는 리플로우 과정이 발생하므로 성능에 좋지 않은 영향을 미치기 때문입니다.\r\n반면 <code class=\"language-text\">visibility</code> 속성을 사용하면 영역은 미리 잡아 놓되 값에 따라 노출, 숨김 처리만 되기 때문에 리플로우 과정을 줄일 수 있습니다.</p>\n<p>역시나 예상대로 깜박이는 현상은 사라지고, 대신 15.5에서 발생하던 것과 같이 사이즈의 너비가 줄었다가 확대되는 모습이 두드러졌습니다.\r\n기존에 비디오 로드 전 <code class=\"language-text\">object-fit</code>의 값을 <code class=\"language-text\">contain</code>으로 잡아 놓았다가 비디오 로드 후 <code class=\"language-text\">cover</code>로 변경했던 방법이 더 이상 적용되지 않는 모습이었죠.</p>\n<p>우선 썸네일과 비디오의 <code class=\"language-text\">object-fit</code> 값을 모두 <code class=\"language-text\">cover</code>에서 <code class=\"language-text\">contain</code>으로 변경해 보았습니다. 그랬더니 역시 아주 매끄럽게 화면 전환이 일어나는 모습을 확인할 수 있었습니다.\r\n역시나 iOS 16 버전에서도 <code class=\"language-text\">cover</code> 값을 처리하지 못하는 것을 확신할 수 있었습니다.</p>\n<p>혹시나 하는 마음으로 <code class=\"language-text\">cover</code>를 <code class=\"language-text\">fill</code>로 변경해 보았습니다. <code class=\"language-text\">fill</code>은 <code class=\"language-text\">cover</code>와 달리 원본 이미지의 비율은 유지되지 않지만 화면을 가득 채우는 효과는 <code class=\"language-text\">cover</code>와 동일합니다.\r\n테스트를 해 보니 <code class=\"language-text\">fill</code>이나 <code class=\"language-text\">cover</code>나 시각적인 차이점은 뚜렷하게 나타나지 않았습니다. 설레는 마음으로 플레이어에 진입해 보았더니 놀랍게도 전혀 위화감 없이 현상이 해결된 모습을 확인할 수 있었습니다!</p>\n<h4>object-fit의 값을 cover에서 fill로 변경</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> loadedClassName <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\r\n\tloaded <span class=\"token operator\">?</span>\r\n\t\t<span class=\"token punctuation\">(</span>direction <span class=\"token operator\">===</span> <span class=\"token string\">'HORIZONTAL'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'landscape'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'fill'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\r\n\t\t<span class=\"token string\">'hidden'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>loaded<span class=\"token punctuation\">,</span> direction<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// 비디오에서 style 속성을 제거하고 클래스로 변경</span>\r\n<span class=\"token operator\">&lt;</span>video\r\n\tclassName<span class=\"token operator\">=</span>$<span class=\"token punctuation\">{</span>loadedClassName<span class=\"token punctuation\">}</span>\r\n\tstyle<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>moving <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">visibility</span><span class=\"token operator\">:</span> <span class=\"token string\">'hidden'</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n\t<span class=\"token operator\">...</span>\r\n<span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<h3>15.x, 16.x 버전 충돌 해결</h3>\n<p>위 코드를 적용한 후 iOS 15.0.1 버전부터 15.4 버전까지 테스트를 해 보았더니 렌더링이 제대로 되지 않는 현상이 나타났습니다. 그래서 예외적으로 위 버전만 분기 처리하여 기존의 코드를 사용하도록 하였고, 나머지 15 버전 이하나 15.5 이상, 안드로이드 버전은 새로운 코드를 사용하도록 처리하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> videoClassName <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\r\n\t<span class=\"token punctuation\">(</span>isUniqueIOSVersion <span class=\"token operator\">?</span> <span class=\"token string\">'landscape'</span> <span class=\"token operator\">:</span> loadedClassName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\r\n  isUniqueIOSVersion<span class=\"token punctuation\">,</span> loadedClassName\r\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> loadedStyle <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\r\n\t<span class=\"token punctuation\">(</span>loaded <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>moving <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> objectFit <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'none'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">[</span>loaded<span class=\"token punctuation\">,</span> moving<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> movingStyle <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\r\n\t<span class=\"token punctuation\">(</span>moving <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'none'</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">[</span>moving<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> videoStyle <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\r\n\t<span class=\"token punctuation\">(</span>isUniqueIOSVersion <span class=\"token operator\">?</span> loadedStyle <span class=\"token operator\">:</span> movingStyle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">[</span>loadedStyle<span class=\"token punctuation\">,</span> movingStyle<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token operator\">&lt;</span>video\r\n  ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>videoEl<span class=\"token punctuation\">}</span>\r\n  className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">obj-video </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>videoClassName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\r\n  style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>videoStyle<span class=\"token punctuation\">}</span>\r\n  <span class=\"token operator\">...</span>\r\n<span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>그리고 기존에 <code class=\"language-text\">visibility</code> 속성으로 변경했던 값을 <code class=\"language-text\">display</code>로 다시 원복시켰습니다. (style 속성 충돌 때문) ⇒ 이 부분은 추후 다시 검토해 볼 예정입니다.</p>\n<h3>transition 적용</h3>\n<p>추가적으로 테스트를 해 보니 가끔 스와이핑을 시작하는 시점에 미세하게 썸네일이 깜박거리는 현상이 발견되었습니다. 이에 <code class=\"language-text\">display</code> 속성이 문제가 된 것을 직감하고 다시 해결 방안을 찾기 시작했습니다.\r\n그러던 중 다른 작은 비디오 화면에서 사용하고 있는 <code class=\"language-text\">transition</code> 속성을 사용하면 어떨까 하는 생각이 들었습니다.\r\n플레이어에서는 <code class=\"language-text\">CSSTransition</code> 컴포넌트를 씌우면 <code class=\"language-text\">object-fit</code> 속성이 제대로 작동하지 않는 이슈가 있어서 style에 직접 적용하는 방법을 선택하였습니다.</p>\n<p><code class=\"language-text\">transition</code> 속성은 다음과 같이 사용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">div <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">transition</span><span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>property<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>duration<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>timing<span class=\"token operator\">-</span><span class=\"token keyword\">function</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>delay<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>transition-property\n<ul>\n<li>트랜지션을 적용해야 하는 css 속성의 이름으로, 트랜지션 하는 동안 여기에 명시된 속성만 움직입니다.</li>\n</ul>\n</li>\n<li>transition-duration\n<ul>\n<li>트랜지션이 일어나는 지속 시간을 명시합니다.</li>\n</ul>\n</li>\n<li>transition-timing-function\n<ul>\n<li>속성의 중간값을 계산하는 방법을 정의합니다. <code class=\"language-text\">ease</code>, <code class=\"language-text\">linear</code>, <code class=\"language-text\">step-end</code>, <code class=\"language-text\">steps</code> 등의 속성이 있습니다.</li>\n</ul>\n</li>\n<li>transition-delay\n<ul>\n<li>속성이 변한 시점과 트랜지션이 실제로 시작하는 사이에 기다리는 시간을 정의합니다.</li>\n</ul>\n</li>\n</ul>\n<p>하지만 <code class=\"language-text\">display</code> 속성과 <code class=\"language-text\">visibility</code> 속성은 모두 <code class=\"language-text\">transition</code> 기능을 사용할 수 없다는 사실을 알게 되었습니다.\r\n자연스러운 화면 전환을 위해서는 css transition이 필수인데, <code class=\"language-text\">transition</code>의 경우 연속적인 숫자로 값을 줄 수 있는 속성에만 작용하기 때문입니다.\r\n그래서 <code class=\"language-text\">display</code> 속성을 <code class=\"language-text\">opacity</code>로 변경하고 <code class=\"language-text\">transition</code> 처리를 하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> movingStyle <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\r\n    moving\r\n      <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token literal-property property\">opacity</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">transition</span><span class=\"token operator\">:</span> <span class=\"token string\">\"opacity 100ms ease-in-out\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">opacity</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>moving<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>iOS 16.2 추가 이슈 해결</h3>\n<p>iOS 16.2 버전 이상부터 플레이어에서 갑자기 렌더링이 이상하게 되는 이슈가 발생했습니다. 기존의 문제점이 화면이 일시적으로 작아졌다가 커진 현상이었다면, 이번에는 반대로 첫 로딩 시에는 화면이 커졌다가 작아지는 문제였습니다.\r\n16.0으로 iOS 버전이 업데이트되면서 추가적으로 발생했던 이슈를 해결하기 위해 <code class=\"language-text\">object-fit</code> 속성을 <code class=\"language-text\">cover</code>에서 <code class=\"language-text\">fill</code>로 변경했었는데요, 아마도 그 조치에 대한 side effect이었던 것이 아닐까 하는 생각이 들었습니다.</p>\n<p>수정 후 테스트를 해본 결과 정상적으로 렌더링이 잘 되는 것을 확인할 수 있었습니다.</p>\n<p>하지만 이렇게 하면 16.0과 16.1 버전에서 여전히 문제가 발생하였기 때문에,\r\n결과적으로 15버전에서 15.5 버전, 그리고 16.0에서 16.1 버전, 현재 최종 버전인 16.3 (16.2 이상) 이렇게 세 가지로 분기 처리를 하기 위해서 코드를 다음과 같이 수정하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// player.tsx (썸네일 보여주는 영역)</span>\r\n\r\n<span class=\"token keyword\">const</span> isIOS16LowVersion <span class=\"token operator\">=</span>\r\n  <span class=\"token function\">isIOS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> iosVersion <span class=\"token operator\">>=</span> <span class=\"token string\">\"16.0\"</span> <span class=\"token operator\">&amp;&amp;</span> iosVersion <span class=\"token operator\">&lt;</span> <span class=\"token string\">\"16.2\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> objectFitClass <span class=\"token operator\">=</span> isIOS <span class=\"token operator\">&amp;&amp;</span> isIOS16LowVersion <span class=\"token operator\">?</span> <span class=\"token string\">\"fill\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"cover\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// videoForIOS.tsx (플레이어 영역)</span>\r\n\r\n<span class=\"token keyword\">const</span> isIOS15Version <span class=\"token operator\">=</span>\r\n  EnvChecker<span class=\"token punctuation\">.</span><span class=\"token function\">isIOS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> iosVersion <span class=\"token operator\">>=</span> <span class=\"token string\">\"15.0\"</span> <span class=\"token operator\">&amp;&amp;</span> iosVersion <span class=\"token operator\">&lt;</span> <span class=\"token string\">\"15.5\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> isIOS16LowVersion <span class=\"token operator\">=</span>\r\n  EnvChecker<span class=\"token punctuation\">.</span><span class=\"token function\">isIOS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> iosVersion <span class=\"token operator\">>=</span> <span class=\"token string\">\"16.0\"</span> <span class=\"token operator\">&amp;&amp;</span> iosVersion <span class=\"token operator\">&lt;</span> <span class=\"token string\">\"16.2\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> objectfitValue <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>isIOS16LowVersion <span class=\"token operator\">?</span> <span class=\"token string\">\"fill\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"cover\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>isIOS16LowVersion<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> directionClassName <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>direction <span class=\"token operator\">===</span> <span class=\"token string\">\"HORIZONTAL\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"landscape\"</span> <span class=\"token operator\">:</span> objectfitValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>direction<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> loadedClassName <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>loaded <span class=\"token operator\">?</span> directionClassName <span class=\"token operator\">:</span> <span class=\"token string\">\"hidden\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>loaded<span class=\"token punctuation\">,</span> directionClassName<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> videoStyle <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>isIOS15Version <span class=\"token operator\">?</span> loadedStyle <span class=\"token operator\">:</span> movingStyle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">[</span>loadedStyle<span class=\"token punctuation\">,</span> movingStyle<span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>마무리</h3>\n<p>결과적으로는 화면이 깜박거리는 현상과 스와이핑 중 썸네일이 사라지는 두 현상 모두 <code class=\"language-text\">loaded</code>와 <code class=\"language-text\">moving</code>의 상태 값, 그리고 이미지를 로드하는 위치, <code class=\"language-text\">object-fit</code> 등의 조합으로 해결할 수 있는 문제였습니다.</p>\n<p>이번 경험을 통해 문제 해결에 접근하는 시야를 좀더 넓게 가질 수 있었고, 성능 최적화라는 목표를 향해 한 걸음씩 나아가며 이슈를 해결하는 여러 가지 방법을 터득할 수 있었습니다.</p>\n<p>그리고 이러한 고민과 노력의 과정이 결국은 사용자에게 더 나은 경험을 제공하고, 서비스의 품질을 높이는 데 많은 기여를 한다고 생각합니다. 😊</p>","frontmatter":{"title":"iOS 환경에서 비디오 최적화 및 성능 개선 사례","date":"January 26, 2023","description":"iOS 환경에서 비디오 최적화 및 성능 개선 사례","author":"jayoon"}},"previous":null,"next":{"fields":{"slug":"/internship/"},"frontmatter":{"title":"2023년 채용연계형 인턴십 프로그램을 소개합니다."}}},"pageContext":{"id":"e788729a-7d49-5d36-9c6e-b7fdcfc740af","previousPostId":null,"nextPostId":"1fa90b8a-ad7a-5cd3-a13c-54cad0949328"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}